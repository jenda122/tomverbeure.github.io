---
layout: post
title: Abusing the Sony CRT Unit of an HP 16500A Logic Analyzer
date:  2022-01-29 00:00:00 -1000
categories:
---

* TOC
{:toc}

# Introduction

In [my previous blog post](/2022/01/29/HP16500a-teardown.html), 
I disassembled an HP 16500A logic analyzer. There wasn't much to it other than getting
a look into a old dinosaur of a machine, one thing that caught my attention was the
CRT unit: unlike most other old CRT-based test equipment such as my
[Tektronix TDS 420A oscilloscope](/2020/06/27/In-the-Lab-Tektronix-TDS420A.html),
the CRT of HP 16500A is not an integral part of the machine, but it's a self-contained
module that can easily slide out of the main chassis.

It made me wonder if there'd be some to use it in some creative ways?

In this blog post, I try to do exactly that. 

# Safety First

Before proceeding, do youself a favor and (re)read the 
[Safety First](/2022/01/29/HP16500a-teardown.html#safety-first)
section of the teardown blog post. The voltage levels in a CRT are no joke, and
even the power supply voltage of 120V DC is high enough to warrant a serious
amount of respect.

# The Sony CHM-9001-00 CRT

The CRT is a Sony CHM-9001-00 with a 10" Trinitron tube and an active screen area of 9".

![Sony sticker on the CRT](/assets/hp16500a/blog_disassembly/28_CRT_sticker.jpg)

The [HP 16500A service manual](/assets/hp16500a/HP16500-90911-Service-Manual.pdf) is the
obvious place to look for information, and there's indeed a little bit there:

* Section 4-2 instructs how to degauss the display. 

    Just press the degauss button at the back of the power supply.

* Section 4-5 explains how to make adjustments to CRT beam convergence, geometry,
  and white balance.

    It's quite a heavy procedure, but these are usually once-and-done trimmer settings 
    that should already be OK. The settings were fine on my 2 units.

* Figures 6-19 and 6-20 have flowcharts from some CRT-related troubleshooting.

    The remedies don't go much further than suggesting to replace cables when things
    an image doesn't show...

* The Video Signals Check on page 6-34 finally has some meat: it lists
  the video related pin numbers on the 40-pin CRT flat cable, the expected
  voltage levels the signals, and even a scope shot of the vertical and 
  horizontal sync signals.

# CRT Display Signals according to the HP Service Manual

Let's have a closer look at the video signal details of page 6-34.

The pin numbers are as follows:

<p align="center"><img alt="CRT cable pin numbers" src="/assets/hp16500a/blog_crt/cable_pin_numbers.png" /></p>

The signal types are pretty traditional: 

* Horizontal sync (pin 3)
* Vertical sync (pin 7)
* 3 analog signals for RGB (pins 21, 29, and 37 for R, G and B resp.)

<p align="center"><img alt="Annotated cable connector" src="/assets/hp16500a/blog_crt/annotated_cable_connector.png" /></p>

If you were wondering about the functionality of the remaining 35 pins of the 40
pin connector, wonder no more: they are either connected to ground or unused. Sony
must have realized the idiocy of such a large connector for just 5 functional pins,
because later members of the HP logic analyzer family have a similar CRT module with
a much smaller connector.

<p align="center"><img alt="Sync signals scope shot" src="/assets/hp16500a/blog_crt/sync_signals.png" /></p>

The voltage levels for the sync signals are a standard 5V TTL (good!), but the
voltage levels for the analog signals are weird, with a baseline of -1.7V and 
a maximum value of 125mV (WTF?), or amplitude of 1.825V.

I was initially hopefull that it'd be easy to drive the CRT module with something that
was similar to a standard PC VGA output, but the voltage levels above were not 
encouraging.

A good look at all the ICs on the main CPU controller board of the logic analyzer shos
that the RGB signals are driven by an NE5150 triple 4-bit RGB DAC.

![NE5150F IC on the CPU PCB](/assets/hp16500a/blog_crt/ne5150f_on_cpu_board.jpg)

<p align="center"><img alt="NE5150 Block Diagram" src="/assets/hp16500a/blog_crt/ne5150_block_diagram.png" /></p>

The [datasheet](/assets/hp16500a/datasheets/NE5150.pdf) has the following to say:

> The DACs include all the composite video functions to make the output waveforms 
> meet RS-170 and RS-343 standards, and produce 1Vpp into 75 Ohm.

The following table goes more in detail:

![NE5150 analog signal parameters](/assets/hp16500a/blog_crt/ne5150_analog_voltage_range.png)

We're seeing an enhanced sync level of -960mV and an enhanced white level of 0mV, for a
total range of 960mV, exactly almost exactly half the 1.825V amplitude that's listed in the
16500A service manual.

What's happening here is that the service manual levels are supposed to be measured on 
connector after it has been unplugged from the CRT module. The NE5150 has an output
resistance of 75 Ohm. If the CRT module has a 75 Ohm input impedance, then the 1.825V on the
connector will be divided in half!

The table also shows a voltage of -674mV for the enhanced blanking level. It doesn't show the
level of black, but that's usually slightly above the blanking voltage. It's safe to say that
the amplitude from black to white will be on the order of ~700mV, which is right in line with 
the R/G/B values of a standard VGA cable.

The only remaining question is one of the negative voltage levels: VGA signalling only has
positive voltage levels.

But what if there's a series capacity inside the CRT module that remove the DC level? In that
case, only the amplitude of the RGB signals matter, not their value relative to ground!

# The Hunt for the Sony CHM-9001-00 Service Manual

To really know all details of the CRT module, you need a good service manual.
Unsurprisingly, Google doesn't turn up a lot of info, but eventually, I struck gold at 
[sonyservicemanual.com](https://www.sonyservicemanual.com/Detail.aspx?ProductID=870483)
which sells the service manual for $17.49 in the form of... a microfiche.

For those unfamiliar: a [microfiche](https://en.wikipedia.org/wiki/Microform#Microfiche) 
is a slide film on which a negative image of a document has been optically projected at greatly 
reduced size (usually by a factor 25.) Multiple pages are stored in matrix format. It dates
from way back when digital storage either didn't exist or was too expensive. 

To display a microfiche, you were supposed use a special reader like the Eyecom 1000 below:

![Eyecom 1000](/assets/hp16500a/blog_crt/eyecom1000.jpg)

It has a glass plate on which your place the microfiche and a projector similar to old projection
TVs that display the pages on a screen.

I had never used microfiches before and was intrigued. The price was still within reason, 
so I went for it. So here is the service manual of the CHM-9001-00:

![CRT service manual on microfiche](/assets/hp16500a/blog_crt/service_manual_microfiche.jpg)

If you don't have access to an Eyecom 1000, how do read such a thing in this day and age? I
tried to photograph it with my [microscope with iPhone camera adapter](/tools/2018/04/30/stereozoom4-iphone-adapter.html).
The result is not great, but it's good enough to extract important information:

![Specifications under the microscope](/assets/hp16500a/blog_crt/specifications_under_microscope.jpg)

*The focus of this photograph would have been much better if I had properly taped the microfiche
on a piece a white paper.*

We can see the following important parameters: 

* resolution: 576x368
* vertical scan rate: 60Hz
* horizontal scan rate: 25kHz 

Still, while good enough to extract text, the microscope method doesn't work for things like
schematics. I needed a better solution. After first checking out commercial scanning
services, I wondered whether local public libraries had a microfiche scanner. And they do!
In fact, the 
[Los Gatos public library](https://www.losgatosca.gov/42/Los-Gatos-Library) 
has a terrific one, and you don't even need a library
card to use it. You do need to figure out yourself how to operate it because "I've worked here
for more than 5 years, and in that time, nobody has used the thing."

![Los Gatos microfiche scanner](/assets/hp16500a/blog_crt/los_gatos_microfiche_scanner.jpg)

After a good hour of scanning all 37 pages, and quite a bit more than that processing
all the images in Pixelmator, I now have the full service manual, with specifications,
calibration routines, block diagram, schematic, and component list.

# Sony CHM-9001-00 Details

Here's the post-processed specification page of the service manual:

![CHM 9001-00 Specification](/assets/hp16500a/blog_crt/chm9001-00-specifications.png)

Of note here is the RGB video signal of 0.714 Vpp with 75 Ohm impedance. That matches
the requirements of a VGA signal.

The schematic of the front-end circuit that interface with the outside world is also
very helpful:

![CHM 9001-00 Input Circuit Annotated](/assets/hp16500a/blog_crt/crt_input_schematic_annotated.png)

In blue, we can see that there are indeed only 5 pins on the display connetor that are not connected 
to ground.

The red region shows the DC blocking capacitors on the R, G, and B path. We don't have to worry about
the DC offset and should be able to directly connect a VGA signal to the CRT. Yay!

The brown region shows how the brightness and contrast inputs got to a blanking, clamping and
amplification circuit for each of the 3 color components.

Finally, there's the green region. It contains pulse generators that work off the H-sync and
the V-sync inputs. If you're a bit familiar with video timings, you know that horizontal and
vertical sync pulses are have either positive or negative polarity, but it was never completely
clear to me why polarity was important. 

In a modern monitor, the sync polarity, along with other timing parameters such as resolution, 
pixel clock etc, of an incoming video signal is sometimes matched against a list of official 
video timings to influence certain behaviors of a monitor. But sync polarity is never used to 
actually synchronize the video signal. In fact, most LCD panels with Vx1 or LVDS input interface 
don't even require the sync signals. The blanking period is sufficient.

But on old school fixed-timing displays such as this one, the sync signals are essential
to control the CRT beam, and the correct polarity is important because there are discrete components 
that were designed specifically with a defined polarity in mind.

We can see that here with H-sync and V-sync: both signals immediately go to pin 9 of 
[SN74LS221N](https://www.ti.com/lit/ds/symlink/sn54221.pdf),
a negative edge trigger of one of its two monostable multivibrators.

<p align="center"><img alt="74LS221 function table" src="/assets/hp16500a/blog_crt/74ls221_function_table.png" width="40%" /></p>

Another crucial piece of information are the detailed video timings:

![Video timing diagrams](/assets/hp16500a/blog_crt/video_timings.png)

<table>
<tr><td>Pixel clock</td><td>20 MHz</td></tr>
<tr><th colspan="2">Horizontal timings</th></tr>
<tr><td>Period</td><td>40uS</td></tr>
<tr><td>Frontporch</td><td> 1.2uS </td></tr>
<tr><td>Sync</td><td> 3.2uS </td></tr>
<tr><td>Backporch</td><td> 6.8uS </td></tr>
<tr><td>Active</td><td> 28.8uS </td></tr>
<tr><th colspan="2">Vertical timings  </th></tr>
<tr><td>Period</td><td> 417 lines </td></tr>
<tr><td>Frontporch</td><td> 4 lines </td></tr>
<tr><td>Sync</td><td> 3 lines </td></tr>
<tr><td>Backporch</td><td> 42 lines </td></tr>
<tr><td>Active</td><td> 368 lines </td></tr>
</table>

All modern monitors have square pixels. That's not the case here: the stated active 
area of 160x120mm has an aspect ratio of 1.33, but active resolution is specified at 576x368 or a 
ratio of 1.57. 

If you really want square pixels, things would be annoying on an LCD display because you'd
either need a scaler or you'd need to insert black bars to the left and the right of the image. 
It's much less of an issue on CRT where individual pixels blend into each other anyway. 
You can lower the pixel clock from 20 MHz to 16.9MHz (=20*1.33/1.57), reduce the
horizontal resolution from 576 to 485, and the analog-only circuitry of the CRT won't have 
a clue that anything happened because all the timings would remain the same. The image quality
might be a little bit lower because the CRT RGB raster won't be the native resolution, chances are
that nobody would notice.

One final detail, but an important one, are the power requirements of 120V +-1V DC. Where are
you going to find a DC power supply like that???


# A First Look at the CRT 

* Information from the HP service manual
    * Section 4-5: Color Display Module Adjustment
 	Includes white balance with RV901 and RV902.
    * Page 6-3 System Overview Theory
        120V supply is only used by the color module.
   	CPU board block diagram
    * Page 6-34: Video Signals Check
	Contains connector pinout.
* How the CRT is driven by the logic analyzer
    * CPU board Block diagram 
    * Chips on the CPU board
    * Voltage levels
    * Connector
* CRT PCBs
* CRT resolution: 576x368
    * Aspect ratio: roughly 14:9
    * old school games (donkey kong, pacman etc): 256x224, 8:7 aspect ratio

# Main Controller Board

* [HP Bench Briefs](/assets/hp16500a/datasheets/HP-Bench-Briefs-1987-10-12.pdf)
    * Contains a list with translation from HP component ID (e.g. 1820-3431) to 
      manufacturer code (DS75160AN).
* [What is a national stock number (NSN)](https://www.aptac-us.org/national-stock-number/)

* MC68000P10
    * CPU
    * [M68000 8-/16-/32-Bit Microprocessors User’s Manual](/assets/hp16500a/datasheets/MC68000FN10_to_MC68HC001RC8.pdf)
* NE5150F
    * Triple 4-Bit RGB D/A Converter With Memory
    * [Datasheet](/assets/hp16500a/datasheets/NE5150.pdf)
* FDC9793
    * Floppy Disk Controller/Formatter
    * [Datasheet](/assets/hp16500a/datasheets/FDC97_datasheet.pdf)
* FDC9229BT
    * Floppy Disk Interface Circuit
    * [Datasheet](/assets/hp16500a/datasheets/FCD9229BT.pdf)
* TMS9914A
    *  TMS9914A General Purpose Interface Bus (GPIB) Controller
    * [Datasheet](/assets/hp16500a/datasheets/TMS9914A_General_Purpose_Interface_Bus_Controller_Data_Manual_Dec82.pdf)
* 1820-2853 -> MC68A45P
    * CRT Controller
    * Lookup found in [this Bench Brief](http://hparchive.com/Bench_Briefs/HP-Bench-Briefs-1984-05-06.pdf)
    * [Datasheet](/assets/hp16500a/datasheets/mc68A45_datasheet.pdf)
* 20MHz Xtal 
* 1820-3431 -> DS75160AN 
    * IEEE-488 GPIB Transceivers
    * [Datasheet](/assets/hp16500a/datasheets/DS75160AN.pdf)
* PAL16R4-2CN
    * [Datasheet](/assets/hp16500a/datasheets/PAL16R8.pdf)
* 74F195N
    * 4-bit parallel-access shift register
    * [Datasheet](/assets/hp16500a/datasheets/74F195A.pdf)
* NEC D41264C-12
    * Dual-Port Graphics Buffer
    * [Datasheet](/assets/hp16500a/datasheets/NECED001-12A-1.pdf)
* DS14C89A
    * Quad CMOS Receiver
    * [Datasheet](https://www.ti.com/lit/ds/symlink/ds14c89a.pdf)
* DS14C88 
    * Quad CMOS Line Driver
    * [Datasheet](https://www.ti.com/lit/ds/symlink/ds14c88.pdf)
* CY7C122-25PC 
    * 256x4 Static R/W RAM
    * [Datasheet](/assets/hp16500a/datasheets/cy7c122.pdf)
* D27C256-2
    *  256 Kilobit (32,768 x 8-Bit) CMOS EPROM
    * [Datasheet](/assets/hp16500a/datasheets/D27C256.pdf)
* 1818-4036 -> Toshiba TC514256P.P-10 (or -80)
    * 262,144 WORDS X 4 BIT DYNAMIC RAM
    * 8 instances -> 1MB of RAM
    * [Datasheet](/assets/hp16500a/datasheets/TC514256P-85-Toshiba.pdf)
* 1RD2-6001
    * HP-HIL Master Chip
    * See [this list](https://how-to.fandom.com/wiki/How_to_identify_integrated_circuit_(IC)_functions_from_their_Hewlett_Packard_(HP)_number)
    * [HIL bus on Wikipedia](https://en.wikipedia.org/wiki/HIL_bus)
    * [The Hewlett-Packard Human Interface Link](http://www.hparchive.com/Journals/HPJ-1987-06.pdf)
      * Contains detailed protocol information.
      * Talks about the Master Link Controller (MLC) on the main device, and Slave Link
        Controller (SLC) on the individual input devices.
    * [tmk_keyboard on GitHub](https://github.com/tmk/tmk_keyboard/wiki/HP-HIL)
    * [HP-HIL Technical Reference Manual](http://www.bitsavers.org/pdf/hp/hp-hil/45918A-90001_HP-HIL_Technical_Reference_Manual_Jan86.pdf)
    * [Adventures with HP-HIL](http://www.dalton.ax/hpkbd/hil/)
      Implements a HIL to PS/2 keyboard bridge


# References

* [HP 16500A/16501A Service Manual][HP 16500A Service Manual]
* [Sony CHM-9001 Service Manual](/assets/hp16500a/sony-chm-9001-00-service-manual.pdf)

[HP 16500A Service Manual]: /assets/hp16500a/HP16500-90911-Service-Manual.pdf
[CHM-9001 Service Manual]: /assets/hp16500a/sony-chm-9001-00-service-manual.pdf

# Footnote

Blah Blah[^1]

[^1]: This is a footnote...


