---
layout: post
title: Abusing the Sony CRT Unit of an HP 16500A Logic Analyzer
date:  2022-01-29 00:00:00 -1000
categories:
---

* TOC
{:toc}

# Introduction

In [my previous blog post](/2022/01/29/HP16500a-teardown.html), 
I disassembled an HP 16500A logic analyzer. There wasn't much to it other than getting
a look into a old dinosaur of a machine, one thing that caught my attention was the
CRT unit: unlike most other old CRT-based test equipment such as my
[Tektronix TDS 420A oscilloscope](/2020/06/27/In-the-Lab-Tektronix-TDS420A.html),
the CRT of HP 16500A is not an integral part of the machine, but it's a self-contained
module that can easily slide out of the main chassis.

It made me wonder if there'd be some to use it in some creative ways?

In this blog post, I try to do exactly that. 

# Safety First

Before proceeding, do youself a favor and (re)read the 
[Safety First](/2022/01/29/HP16500a-teardown.html#safety-first)
section of the teardown blog post. 

# The Sony CHM-9001-00 CRT

The CRT is a Sony CHM-9001-00 with a 10" Trinitron tube and an active screen area of 9".

![Sony sticker on the CRT](/assets/hp16500a/blog_disassembly/28_CRT_sticker.jpg)

The [HP 16500A service manual](/assets/hp16500a/HP16500-90911-Service-Manual.pdf) is the
obvious place to look for information, and there's indeed a little bit there:

* Section 4-2 instructs how to degauss the display. (Just press the degauss button
  at the back of the power supply.)
* Section 4-5 explains how to make adjustments to CRT beam convergence, geometry,
  and white balance.

    It's quite a heavy procedure, but these are usually once-and-done trimmer settings 
    that should already be OK for your unit. The settings were fine on mine.

* Figures 6-19 and 6-20 have flowcharts from some CRT-related troubleshooting.

    The remedies don't go much farther than suggesting to replace cables when things
    an image doesn't show...

* The Video Signals Check on page 6-34 finally has some meat: it lists
  the video related pin numbers on the 40-pin CRT flat cable, the expected
  voltage levels the signals, and even a scope shot of the vertical and 
  horizontal sync signals.

# CRT Display Signals according to the HP Service Manual

Let's have a closer look at the video signal details of page 6-34.

The pin numbers are as follows:

![CRT cable pin numbers](/assets/hp16500a/blog_crt/cable_pin_numbers.png)

The signal types are pretty traditional: 

* Horizontal sync (pin 3)
* Vertical sync (pin 7)
* 3 analog signals for RGB (pins 21, 29, and 37 for R, G and B resp.)

![Annotated cable connector](/assets/hp16500a/blog_crt/annotated_cable_connector.png)

If you were wondering about the functionality of the remaining 35 pins of the 40
pin connector, wonder no more: they are either connected to ground or unused. Sony
must have realized the idiocy of such a large connector for just 5 functional pins,
because later members of the HP logic analyzer family have a similar CRT module with
a much smaller connector.

![Sync signals scope shot](/assets/hp16500a/blog_crt/sync_signals.png)

The voltage levels for the sync signals are a standard 5V TTL (good!), but the
voltage levels for the analog signals are weird, with a baseline of -1.7V and 
a maximum value of 125mV (WTF?), or amplitude of 1.825V.

I was initially hopefull that it'd be easy to drive the CRT module with something that
was similar to a standard PC VGA output, but the voltage levels above were not 
encouraging.

A good look at all the ICs on the main CPU controller board of the logic analyzer shos
that the RGB signals are driven by an NE5150 triple 4-bit RGB DAC.

![NE5150 Block Diagram](/assets/hp16500a/blog_crt/ne5150_block_diagram.png)

The [datasheet](/assets/hp16500a/datasheets/NE5150.pdf) has the following to say:

> The DACs include all the composite video functions to make the output waveforms 
> meet RS-170 and RS-343 standards, and produce 1Vpp into 75 Ohm.

The following table goes more in detail:

![NE5150 analog signal parameters](/assets/hp16500a/blog_crt/ne5150_analog_voltage_range.png)

We're seeing an enhanced sync level of -960mV and an enhanced white level of 0mV, for a
total range of 960mV, exactly almost exactly half the 1.825V amplitude that's listed in the
16500A service manual.

What's happening here is that the service manual levels are supposed to be measured on 
connector after it has been unplugged from the CRT module. The NE5150 has an output
resistance of 75 Ohm. If the CRT module has a 75 Ohm input impedance, then the 1.825V on the
connector will be divided in half!

The table also shows a voltage of -674mV for the enhanced blanking level. It doesn't show the
level of black, but that's usually slightly above the blanking voltage. It's safe to say that
the amplitude from black to white will be on the order of ~700mV, which is right in line with 
the R/G/B values of a standard VGA cable.

The only remaining question is one of the negative voltage levels: VGA signalling only has
positive voltage levels.

But what if there's a series capacity inside the CRT module that remove the DC level? In that
case, only the amplitude of the RGB signals matter, not their value relative to ground!

# The Hunt for the Sony CHM-9001-00 Service Manual

To really know all details of the CRT module, you need its datasheet or a service manual.
Unsurprisingly, Google doesn't turn up a lot of info, but eventually, I struck gold 
when a page mentioned that the service manual was for sale... in the form of a microfiche.

For those who don't know: microfiche is a storage format where a document is optically shrunk 
by a factor of XXX and stored with negative colors on slide. It used to be a common archival 
format from way back when digital storage was too expensive. To display a microfiche, you were
supposed to place it on a special reader. 

I had never used microfiches before and was intrigued. The $30 price of the service manual was 
still within reason, so I went for it. This is the service manual of the CHM-9001-00:

# Full Sony CHM-9001-00 Specification

![CHM 9001-00 Specification](/assets/hp16500a/blog_crt/chm9001-00-specifications.png)

![CHM 9001-00 Input Circuit](/assets/hp16500a/blog_crt/crt_input_schematic.png)

One thing that I had never given much thought is why video timings have positive or
negative sync pulses. In modern monitors, the polarity of the sync pulses is not particularly
important: they are sometimes used to match incoming video timings against official timings
to derive certain input signal characteristics, but they are never used to actually synchronize
the video signal: most LCD panels with Vx1 or LVDS input interface don't even require the
sync signals. The blanking period is sufficient.

But on old school fixed-timing displays such as this one, the sync signals are essential
to control the CRT beam, and the polarity is important because there are discrete components 
that were design specifically with a defined polarity in mind.

We can see that here with H-sync and V-sync: both signals immediately got to pin 9 of an 
SN74LS221N pulse generator. Pin 9 is connected to input A of a XXX: it triggers a delay
unit on a falling edge.



# A First Look at the CRT 

* Information from the HP service manual
    * Section 4-5: Color Display Module Adjustment
 	Includes white balance with RV901 and RV902.
    * Page 6-3 System Overview Theory
        120V supply is only used by the color module.
   	CPU board block diagram
    * Page 6-34: Video Signals Check
	Contains connector pinout.
* How the CRT is driven by the logic analyzer
    * CPU board Block diagram 
    * Chips on the CPU board
    * Voltage levels
    * Connector
* CRT PCBs
* CRT resolution: 576x368
    * Aspect ratio: roughly 14:9
    * old school games (donkey kong, pacman etc): 256x224, 8:7 aspect ratio

# Main Controller Board

* [HP Bench Briefs](/assets/hp16500a/datasheets/HP-Bench-Briefs-1987-10-12.pdf)
    * Contains a list with translation from HP component ID (e.g. 1820-3431) to 
      manufacturer code (DS75160AN).
* [What is a national stock number (NSN)](https://www.aptac-us.org/national-stock-number/)

* MC68000P10
    * CPU
    * [M68000 8-/16-/32-Bit Microprocessors Userâ€™s Manual](/assets/hp16500a/datasheets/MC68000FN10_to_MC68HC001RC8.pdf)
* NE5150F
    * Triple 4-Bit RGB D/A Converter With Memory
    * [Datasheet](/assets/hp16500a/datasheets/NE5150.pdf)
* FDC9793
    * Floppy Disk Controller/Formatter
    * [Datasheet](/assets/hp16500a/datasheets/FDC97_datasheet.pdf)
* FDC9229BT
    * Floppy Disk Interface Circuit
    * [Datasheet](/assets/hp16500a/datasheets/FCD9229BT.pdf)
* TMS9914A
    *  TMS9914A General Purpose Interface Bus (GPIB) Controller
    * [Datasheet](/assets/hp16500a/datasheets/TMS9914A_General_Purpose_Interface_Bus_Controller_Data_Manual_Dec82.pdf)
* 1820-2853 -> MC68A45P
    * CRT Controller
    * Lookup found in [this Bench Brief](http://hparchive.com/Bench_Briefs/HP-Bench-Briefs-1984-05-06.pdf)
    * [Datasheet](/assets/hp16500a/datasheets/mc68A45_datasheet.pdf)
* 20MHz Xtal 
* 1820-3431 -> DS75160AN 
    * IEEE-488 GPIB Transceivers
    * [Datasheet](/assets/hp16500a/datasheets/DS75160AN.pdf)
* PAL16R4-2CN
    * [Datasheet](/assets/hp16500a/datasheets/PAL16R8.pdf)
* 74F195N
    * 4-bit parallel-access shift register
    * [Datasheet](/assets/hp16500a/datasheets/74F195A.pdf)
* NEC D41264C-12
    * Dual-Port Graphics Buffer
    * [Datasheet](/assets/hp16500a/datasheets/NECED001-12A-1.pdf)
* DS14C89A
    * Quad CMOS Receiver
    * [Datasheet](https://www.ti.com/lit/ds/symlink/ds14c89a.pdf)
* DS14C88 
    * Quad CMOS Line Driver
    * [Datasheet](https://www.ti.com/lit/ds/symlink/ds14c88.pdf)
* CY7C122-25PC 
    * 256x4 Static R/W RAM
    * [Datasheet](/assets/hp16500a/datasheets/cy7c122.pdf)
* D27C256-2
    *  256 Kilobit (32,768 x 8-Bit) CMOS EPROM
    * [Datasheet](/assets/hp16500a/datasheets/D27C256.pdf)
* 1818-4036 -> Toshiba TC514256P.P-10 (or -80)
    * 262,144 WORDS X 4 BIT DYNAMIC RAM
    * 8 instances -> 1MB of RAM
    * [Datasheet](/assets/hp16500a/datasheets/TC514256P-85-Toshiba.pdf)
* 1RD2-6001
    * HP-HIL Master Chip
    * See [this list](https://how-to.fandom.com/wiki/How_to_identify_integrated_circuit_(IC)_functions_from_their_Hewlett_Packard_(HP)_number)
    * [HIL bus on Wikipedia](https://en.wikipedia.org/wiki/HIL_bus)
    * [The Hewlett-Packard Human Interface Link](http://www.hparchive.com/Journals/HPJ-1987-06.pdf)
      * Contains detailed protocol information.
      * Talks about the Master Link Controller (MLC) on the main device, and Slave Link
        Controller (SLC) on the individual input devices.
    * [tmk_keyboard on GitHub](https://github.com/tmk/tmk_keyboard/wiki/HP-HIL)
    * [HP-HIL Technical Reference Manual](http://www.bitsavers.org/pdf/hp/hp-hil/45918A-90001_HP-HIL_Technical_Reference_Manual_Jan86.pdf)
    * [Adventures with HP-HIL](http://www.dalton.ax/hpkbd/hil/)
      Implements a HIL to PS/2 keyboard bridge


# References

* [HP 16500A/16501A Service Manual][HP 16500A Service Manual]
* [Sony CHM-9001 Service Manual](/assets/hp16500a/sony-chm-9001-00-service-manual.pdf)

[HP 16500A Service Manual]: /assets/hp16500a/HP16500-90911-Service-Manual.pdf
[CHM-9001 Service Manual]: /assets/hp16500a/sony-chm-9001-00-service-manual.pdf

# Footnote

Blah Blah[^1]

[^1]: This is a footnote...


