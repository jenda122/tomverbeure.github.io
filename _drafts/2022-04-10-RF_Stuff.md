---
layout: post
title: RF Stuff
date:  2022-04-10 00:00:00 -1000
categories:
---

* TOC
{:toc}


*I've been playing with a spectrum analyzer and some very basic RF stuff, and I needed
a place to take notes. This is where I do that...*

# Spectrum Analyzer 

A spectrum analyzer has limits about what can be fed into its input.

For example, my HP 8590B has the following input characteristics:

* 50 Ohm impedance

    This is true for almost all RF equipment (analyzer, signal generators,
    oscilloscope.) When you make calculations, just assume that there's a 50 Ohm
    resistor between power and ground at the input of the analyzer.

    (There's some equipment out there that has a 75 Ohm impedance.)

* max power: 30 dBm. 

    This corresponds to 1W. It's a pretty typical value.



* max VDC: 25V.

    This is definitely not always the case. Some spectrum analyzers don't allow
    and DC voltage at all, and applying it will result in damage. If you're unsure
    about the signal source, you can apply a DC blocker at the input of the analyzer,
    or put a series capacitor in your circuit. 

# dBM and Watts

The conversion from dBm to Watts uses the following formula:

*P(W) = 10^((dBm-30)/10)*

a dBm of 0 results in 10^(-3) = 1mW.

Conversely, to go from Watts to dBm, you do: 

*P(dBm) = (log10(W)\*10) + 30*

* [dBm to Watt calculator](https://www.rapidtables.com/convert/power/dBm_to_Watt.html)
* [Watt to dBm calculator](https://www.rapidtables.com/convert/power/Watt_to_dBm.html)

# Impedance Matching

* [Wikipedia: Maximum power transfer theorem](https://en.wikipedia.org/wiki/Maximum_power_transfer_theorem)
* [Wikipedia: Impedance matching](https://en.wikipedia.org/wiki/Impedance_matching)
* [Back to Basics: Impedance Matching](https://www.mwrf.com/technologies/systems/article/21167982/electronic-design-back-to-basics-impedance-matching-part-1)


# Various calibration exercises 

**Equipment**

* HP 8656A signal generator

    $90 flea market find. 

    It has issues with an unreliable power button, but when everything works (and they usually do), 
    things
    

**Calibration output measurements**

The HP 8590B has a 300 MHz/-20 dBm calibration output. It's be a long time since it has last
been calibrated, so I connect the output to an Advantest R3273 that I also have access to.

When I select a center frequency of 300 MHz and a span of 1 MHz, the R3273 measures 300.008 MHz
and -21.66 dBm.

The R3273 itself has a 30 MHz/-10 dBm calibrfation output. When set to 30 MHz center and 1 MHz
span, it measures 30.005 MHz and -10.5 dBm.



# and measuring a cheap attenuator


# Measuring the power of a Baofeng 

I have a Baofeng UV-5R. They are dirt cheap, and known to be the best handheld
transmitters every created by mankind. (I have a HAM license, so I'm technically
allowed to transmit with them, but there's a difference between passing a test
and knowing what you're doing, so I don't actually use them.)

According to their website, a UV-5R has 2 transmit power settings:

TXP low and TXP high, which are supposed to correspond to 1W and 4W. That corresponds
to 30dBm and 36dBM resp. The latter is too much to safely connect to a logic analyzer.

I'm connecting the Baofeng through a 30dB attenuator.

![Baofeng output going to 30dB attenuator and then going to HP 8590B spectrum analyzer](/assets/rf_stuff/baofeng_30db_attn.jpg)


I then do the following:

* PRESET on the analyzer

    This sets the span to full range, and whole bunch of other default settings.

* Set the Baofeng to 133MHz.
* Set the transmit power to high (menu option 2: TXP HIGH)
* Press the PTT button on the left of the handset
    You should see a whole bunch of peaks in the analyzer now.

    If you transmit at this power setting for more than a few second, the cheap
    attenuator gets quite hot and starts to smell a bit! 

* Press the Peak Search button, while the PTT button is pressed.

You should now see this:

!


The marker shows 140MHz (the frequency value is not super accurate) and a power of 8.36 dBm.
Taking into account the attenuation of 30dB, that comes out to a total of 38.36 dBm, 2.3 dBm higher
than expected. After connecting the 30dB attenuator to the -20dBm calibration output, you can see a power
of -48.6 dBm, not -50dBm. It's not unexpected that a $2 AliExpress attenuator isn't quite as
accurate as expected! 

Still, after this correct, the output is still higher than 4W. According to 
[this blog post](https://www.experimental-engineering.co.uk/2015/07/17/baofeng-uv-5r-rf-power-measurements/), 
the power output of these handsets isn't very accurate...

# Step Attenuator

* [EEVblog forum: HP 8644B Attenuator Question](https://www.eevblog.com/forum/testgear/hp-8644b-attenuator-question/)
    * [Youtube: HP 8642B Trouble shooting](https://www.youtube.com/watch?v=9QTGACEd6H0)

        Focuses on attenuator failure

    * [Youtube: HP 8642B Teardown and Final Thoughts (Part 2)](https://www.youtube.com/watch?v=9p8YitCo0jg)

        Attenuator repair

* [EEVblog forum: HP Programmable RF Attenuator Repair](https://www.eevblog.com/forum/repair/hp-programmable-rf-attenuator-repair/)

    * [Youtube: HP RF Attenuators: o-ring repair](https://www.youtube.com/watch?v=eChxU90OgGk)

* [Step Attenuator Repair](http://ve2azx.net/technical/HP_StepAttenuatorRepair.pdf)

* [The Signal Path: Teardown & Analysis of Microwave (26.5GHz) Electro-Mechanical Step Attenuators](https://www.youtube.com/watch?v=IQZxvtEn4T8)
* [TRX Lab: #58 Teardown: HP/ Agilent precision step attenuator for HP/Agilent Signal Generator 8648 series](https://www.youtube.com/watch?v=0dAv6Z1CCwQ)
* [HP 33321C,D,G datasheet](/assets/rf_stuff/hp33321sg-hp33321sc-hp33321sd.pdf)
* [HP 33320 series attenuators datasheet](/assets/rf_stuff/Agilent HP 33320 series attenuators datasheet.pdf)
* [Controller for HP/Agilent 8494G/H and 8496G/H](http://www.illipe.se/Att_controller/Attenuator_controller.html)

# Misc

* [Hackaday Superconference: an analog engineer dives into RF](https://hackaday.com/2019/12/09/hackaday-superconference-an-analog-engineer-dives-into-rf/)
* [Hackaday: Michael Ossmann makes you an rf design hero](https://hackaday.com/2016/03/23/michael-ossmann-makes-you-an-rf-design-hero/)

# References

* [Passive attenuators](https://www.electronics-tutorials.ws/attenuators/attenuator.html)
